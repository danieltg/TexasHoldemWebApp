<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script type="text/javascript" src="../jquery-2.0.3.min.js"></script></head>

    <script type="text/javascript" language="javascript">
        // let's start the jQuery while I wait.
        // step 1: onload - capture the submit event on the form.
        $(function() { // onload...do
            $("#uploadForm").submit(function() {

                var file1 = this[0].files[0];

                var formData = new FormData();
                formData.append("fake-key-1", file1);

                $.ajax({
                    method:'POST',
                    data: formData,
                    url: this.action,
                    processData: false, // Don't process the files
                    contentType: false, // Set content type to false as jQuery will tell the server its a query string request
                    timeout: 4000,
                    error: function(e) {
                        console.error("Failed to submit");
                        $("#result").text("Failed to get result from server " + e);
                    },
                    success: function(r) {
                        $("#result").text("Your game has been submitted successfully.");
                        console.info(r);
                        obj = JSON.parse(r);

                        $('<tr>').html(
                            "<td>" + obj.gameTitle + "</td>" +
                            "<td>" + obj.uploadedBy + "</td>" +
                            "<td>" + obj.structure.handsCount + "</td>" +
                            "<td>" + obj.numberOfPlayers + "</td>"+
                            "<td>" + obj.registeredPlayers + "</td>" +
                            "<td>" + obj.structure.blindes.big + "</td>" +
                            "<td>" + obj.structure.blindes.small + "</td>" +
                            "<td>" + obj.structure.buy + "</td>"+
                            "<td>" + obj.structure.blindes.fixed==false? 'false':'111' + "</td>" )
                            .appendTo('#games_table');

                    }
                });

                // return value of the submit operation
                // by default - we'll always return false so it doesn't redirect the user.
                return false;
            })
        })
    </script>

</head>
<body>
<h3>Select a File:</h3>
<form id="uploadForm" action="/upload" enctype="multipart/form-data" method="POST">
    <input type="file" name="file1" accept=".xml"><br>
    <input type="Submit" value="Upload File"><br>
</form>

<div id="result">
</div>

<table id="games_table" class="table">
    <tr>
        <th>Game Title</th>
        <th>Uploaded by</th>
        <th>Hands Count</th>
        <th>Total Players</th>
        <th>Registered Players</th>
        <th>Big</th>
        <th>Small</th>
        <th>Buy</th>
        <th>Fixed Blindes</th>
    </tr>
</table>

</body>
</html>
